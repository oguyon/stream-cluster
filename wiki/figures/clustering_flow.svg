<svg width="600" height="400" xmlns="http://www.w3.org/2000/svg">
  <!-- Background for readability on dark themes -->
  <rect width="100%" height="100%" fill="white" />

  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <!-- Flowchart Nodes -->
  <rect x="200" y="20" width="200" height="40" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5" />
  <text x="300" y="45" font-family="sans-serif" font-size="14" text-anchor="middle">New Frame (fi)</text>

  <rect x="200" y="90" width="200" height="40" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5" />
  <text x="300" y="115" font-family="sans-serif" font-size="14" text-anchor="middle">Normalize &amp; Rank Probs</text>

  <rect x="200" y="160" width="200" height="40" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5" />
  <text x="300" y="185" font-family="sans-serif" font-size="14" text-anchor="middle">Check Candidate (cj)</text>

  <polygon points="300,230 400,280 300,330 200,280" fill="#e0f7fa" stroke="#333" stroke-width="2"/>
  <text x="300" y="285" font-family="sans-serif" font-size="14" text-anchor="middle">dist &lt; rlim?</text>

  <rect x="420" y="260" width="150" height="40" fill="#e8f5e9" stroke="#333" stroke-width="2" rx="5" />
  <text x="495" y="285" font-family="sans-serif" font-size="14" text-anchor="middle">Assign to cj</text>

  <rect x="30" y="260" width="150" height="40" fill="#ffebee" stroke="#333" stroke-width="2" rx="5" />
  <text x="105" y="285" font-family="sans-serif" font-size="14" text-anchor="middle">Prune / Next</text>

  <!-- Arrows -->
  <line x1="300" y1="60" x2="300" y2="90" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="300" y1="130" x2="300" y2="160" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="300" y1="200" x2="300" y2="230" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />

  <line x1="400" y1="280" x2="420" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="410" y="275" font-family="sans-serif" font-size="12" text-anchor="middle">Yes</text>

  <line x1="200" y1="280" x2="180" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="190" y="275" font-family="sans-serif" font-size="12" text-anchor="middle">No</text>

  <path d="M 105 260 L 105 180 L 200 180" fill="none" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

</svg>
